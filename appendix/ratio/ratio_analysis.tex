\graphicspath{ {./figures/ratio/} }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Quantification of expression levels}
\label{appendix:ratio:quantification}

Expression dynamics were inferred from confocal image stacks using an updated version of an existing segmentation and annotation pipeline \cite{Pelaez2015a}. The new pipeline includes \textit{FlyEye Silhouette}; an open-source package for macOS that integrates our image segmentation algorithm with a GUI for cell type annotation. Subsequent analysis and visualization procedures were implemented in Python.

In all cases, cell segmentation was performed using either H2Av-mRFP or DAPI signals as a reference channel for identification of cell nuclei boundaries. Each layer of the reference channel was segmented independently. A single contour containing each unique cell was manually selected and assigned a cell type using a custom graphic user interface. DAPI-stained discs were segmented using a separate script based on the watershed algorithm in order to mitigate the effect of bright spots caused by DAPI accumulation in nucleoli. Further care was taken to avoid annotating contours containing such nucleoli. For each annotated cell contour, expression measurements were obtained by normalizing the mean fluorescence of the Pnt-GFP and Yan antibody channels by the mean fluorescence of the reference channel. This normalization serves to mitigate variability due to potentially uneven sample illumination, segment area, and in the case of His-RFP, differences in protein expression capacity between cells.

\section{Conversion of distance to time}
\label{appendix:ratio:distance_to_time}

Cell positions along the anterior-posterior axis were mapped to developmental time as described previously \cite{Pelaez2015a,Pelaez2016}. This is predicated on two assumptions: the furrow proceeds at a constant rate of one column of R8 neurons per two hours, and minimal cell migration occurs. We find no reason to discard these assumptions.

For each disc, Delaunay triangulations were used to estimate the median distance between adjacent columns of R8 neurons \cite{Fortune1992}. We used the median rather than the mean distance, as was used in our previous study, because it minimized the influence of non-adjacent R8s that were falsely identified by the triangulation. Dividing the furrow velocity of 2 h per column by this median distance yields a single conversion factor from position along the anterior-posterior axis to developmental time. This factor was applied to all cell measurements within the corresponding disc, yielding expression time series. Notably, these are not single cell dynamics, but rather aggregate dynamics across the development time course of a cell population.

\section{Computation of moving averages and confidence intervals}
\label{appendix:ratio:moving_averages}

Moving averages were computed by first-order Savitzky-Golay filtration \cite{Savitzky1964}. This method augments the simple windowing approach used in our previous study \cite{Pelaez2015a} by enabling visualization of expression trends at early time-points that are otherwise obscured by large window sizes. A secondary first-order filtration with one-fifth the original window size was applied to smooth lines for visualization purposes.

None of our conclusions are sensitive to our choice of filtration or smoothing method \cite{Pelaez2015a}. Primary window sizes of 250 and 75 cells were used for reporting the expression of multipotent and differentiated cells, unless noted otherwise. Confidence intervals for the moving average were inferred from the 2.5th and 97.5th percentile of 1000 point estimates of the mean within each window. Point estimates were generated by bootstrap resampling (with replacement) the expression levels within each window.

\section{Alignment of expression data}
\label{appendix:ratio:alignment}

Cells were aligned with a reference population by shifting them in time. The magnitude of this shift was determined by maximizing the cross-correlation of progenitor Pnt-GFP expression $Y(t)$ with the corresponding reference time series $X(t)$. Rather than raw measurements, moving averages within a window of ten cells were used to improve robustness against noise. This operation amounts to:
\begin{equation}
\argmax_{dt} \ { E \Big[ \frac{(Y(t+dt)-\mu_Y)(X(t+dt)-\mu_X)}{\sigma_Y \sigma_X} \Big] }
\end{equation}
where, $\mu$ and $\sigma$ are the mean and standard deviation of each time series, and $dt$ is the time by which the population should be shifted.

For each experimental treatment, a disc was randomly chosen and shifted in time such that time zero corresponds to the first annotated R8 neuron. This disc then served as the reference population for the alignment of all subsequent biological replicates within the treatment. Similarly, different experimental treatments (e.g. control and perturbation) were aligned by first aligning the discs within each treatment, then aggregating all cells within each treatment and repeating the procedure with the first treatment serving as the reference.

This approach differs from the previous implementation of our pipeline in which discs were manually aligned by the inflection point of their Yan-YFP expression profiles \cite{Pelaez2015a}. Manual alignment entails arbitrary prioritization of certain dynamic features over others. Our revised protocol yields consistent, reproducible alignment of expression time series that equally weighs the entire time course. The automated approach is more principled but less robust than the manual approach. Specifically, it fails when dynamic forms qualitatively differ between experimental treatments. In these instances, we revert to manual alignment using the inflection point of Pnt-GFP induction as a reference.

\section{Analysis of \textit{yan} clones}
\label{appendix:ratio:clones}

We used \textit{ey$>$FLP} and \textit{FRT40A} to generate \textit{yan\textsuperscript{833}} null clones within 23 eye discs carrying the Pnt-GFP transgene (see Section \ref{appendix:ratio:genetics}). The chromosome carrying the wildtype \textit{yan} allele was marked with a Ubi-mRFPnls transgene, enabling automated detection of subpopulations with distinct \textit{yan} gene dosages, each characterized by a distinct level of mRFP fluorescence. Discs were dissected, fixed, and co-stained with DAPI prior to confocal imaging. Images of 36 unique vertical cross-sections spanning non-overlapping cells were collected in total. 

We deployed the framework developed in Chapter \ref{ch:clones} to measure the expression level of each reporter in each nucleus and automatically label each measurement as mutant, heterozygous, or homozygous for the Ubi-mRFPnls clonal marker. For each segment, Ubi-mRFPnls and Pnt-GFP fluorescence was quantified by normalizing the average intensity of all pixels within the respective fluorescence channel by the average DAPI fluorescence. Segments containing less than 250 pixels were removed. 

Fluorescence bleedthrough between the RFP and GFP channels was visually apparent in these discs. To confirm our suspicion, control clones were generated in six wildtype \textit{yan} eye discs co-expressing Ubi-mRFPnls and Pnt-GFP. These are the same discs as those analyzed in Chapter \ref{ch:clones}. We used the correction strategy presented in Section \ref{ch:clones:correction} to systematically correct for bleedthrough from the Ubi-mRFPnls reporter into the GFP channel. The correction successfully eliminated any detectable difference in Pnt-GFP expression between Ubi-mRFPnls genotypes in the wildtype \textit{yan} control discs (see Fig. \ref{fig:clones:fig2}C). The same procedure was applied to all measurements of \textit{yan} null clones included in Fig. \ref{fig:ratio:fig4}H.

As described in Section \ref{ch:clones:model_fit}, we limited the analysis to cells of similar developmental age that were located immediately posterior to the MF in each eye disc. These restrictions served to buffer against differences in developmental context and focus attention on the region of elevated Pnt-GFP expression. Cells residing on the border of each clone were excluded from all comparisons to mitigate edge effects. The remaining measurements were aggregated across all eye discs for statistical comparison between clonal genotypes.

\section{Parameterization of equilibrium binding model}
\label{appendix:ratio:model_params}

We restricted our focus to a regulatory element comprised of 12 binding sites in which only the first site carried the ETS designation. We retain the same parameterization of Yan binding proposed by Hope, Rebay, and Reinitz (2017): $\alpha_Y$ = -9.955 kcal mol\textsuperscript{-1}, $\beta_Y$ = -5.837 kcal mol\textsuperscript{-1}, and $\gamma_Y$ = -7.043 kcal mol\textsuperscript{-1}. We parameterized Pnt binding thermodynamics to provide balanced competition between Pnt and Yan in the absence of any SAM-mediated polymerization of Pnt. That is, we set Pnt binding affinities such that the transition from Pnt to Yan occupancy occurs when Pnt and Yan concentrations are approximately equal. While a parameterization using experimentally measured data would improve predictive accuracy, our aim here is primarily to obtain insight. The model used to generate Fig. \ref{fig:ratio:fig3}D-F assumes that Pnt binds individual sites with elevated affinities $\alpha_P = 0.96 (\alpha_Y + \gamma_Y )$ and $\beta_P = 0.96 (\beta_Y + \gamma_Y )$. The model used to generate Fig. \ref{fig:ratio:fig3}A-C uses these same elevated binding affinities for Yan, while setting $\gamma_Y$ = 0 kcal mol\textsuperscript{-1}. Qualitatively, our results are not sensitive to this parameterization. 

\section{Visualization of relative Pnt and Yan expression in \textit{Notch} mutant discs}
\label{appendix:ratio:notch_images}

Visualizations were constructed by applying a smoothing operation to maximum intensity projections across confocal layers spanning progenitors, and then mapping the absolute difference in Pnt-GFP and Yan antibody fluorescence to a diverging color scale. The smoothing operation consists of three sequential applications of a grey-closing filter followed by a single pass of a three-pixel wide median filter. This procedure dampens noise. Raw image fluorescence intensities were normalized to a 0-1 scale before application of any filters, so the maximum possible difference between Pnt-GFP and Yan fluorescence channels is unity. The color scale was truncated to a range of -0.3 to 0.3 for visualization purposes. No post-processing was applied to the maximum intensity projections used to generate the visualization.

\section{Analysis of periodic spatial patterns in \textit{Notch} mutant discs}
\label{appendix:ratio:autocorrelation}

Progenitor cells were selected from a 1.75 h window immediately posterior to the morphogenetic furrow. This window corresponds to approximately one column of eventual ommatidia. The window is identifiable in \textit{Notch} mutant discs because the MF serves as a reference. Digital spatial signals were assembled by sampling progenitor $log_2$-transformed Pnt-to-Yan ratios, $X$, as a function of cell position along the dorso-ventral axis, $y$. Both autocorrelation analysis and spectral decomposition were applied to these signals.

Autocorrelation functions were assembled by computing the moving average of expression similarity, $C$, as a function of dorso-ventral separation distance, $d$:
\begin{equation}
C_{ij} = \frac{ (X_i-E[X])(X_j-E[X]) }{ E[X^2] - E[X]^2 }
\end{equation}
\begin{equation}
d_{ij} = | y_i - y_j |
\end{equation}
where $E$ denotes the expected value, and $i$ and $j$ are indexed over all cells in order of increasing separation distance. Moving averages and confidence intervals were computed as described previously, with a window size of 50 sequential values.

Spatial signals were decomposed into spectral components via the Lomb-Scargle periodogram using the AstroML software package \cite{VanderPlas2012}. These periodograms were used rather than Fourier decomposition because they enable spectral decomposition of irregularly sampled signals \cite{VanderPlas2018}. Significance thresholds were inferred from the 95th percentile of peak spectral powers detected during repeated decomposition of 1000 null signals. Null signals were constructed by resampling signal intensities while maintaining constant sampling times.
